<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học Thiết kế Website - Nền tảng khóa học</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            background-color: #ffffff;
            border-right: 1px solid #e5e7eb;
        }
        .sidebar-link {
            transition: background-color 0.2s, color 0.2s;
        }
        .sidebar-link.active, .sidebar-link:hover {
            background-color: #f3f4f6;
            color: #4f46e5;
        }
        .lesson-item.active {
            background-color: #eef2ff;
            color: #4f46e5;
            font-weight: 600;
        }
        .lesson-item:hover {
            background-color: #f9fafb;
        }
        .lesson-item.completed .lesson-icon {
            color: #10b981; /* Green for completed */
        }
        .section-content {
            display: none;
        }
        .section-content.open {
            display: block;
        }
    </style>
</head>
<body>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 sidebar hidden md:flex flex-col flex-shrink-0">
            <div class="p-6 text-2xl font-bold text-indigo-600 border-b">
                <a href="dashboard.html"><i class="fas fa-book-open-reader mr-2"></i>Khóa Học</a>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="dashboard.html" class="flex items-center px-4 py-2.5 rounded-lg sidebar-link">
                    <i class="fas fa-tachometer-alt w-6 text-center"></i>
                    <span class="ml-3">Bảng điều khiển</span>
                </a>
                <a href="#" class="flex items-center px-4 py-2.5 rounded-lg sidebar-link active">
                    <i class="fas fa-layer-group w-6 text-center"></i>
                    <span class="ml-3">Khóa học của tôi</span>
                </a>
                <a href="#" class="flex items-center px-4 py-2.5 rounded-lg sidebar-link">
                    <i class="fas fa-user-circle w-6 text-center"></i>
                    <span class="ml-3">Hồ sơ</span>
                </a>
            </nav>
            <div class="p-4 border-t">
                <button onclick="logoutUser()" class="w-full flex items-center justify-center px-4 py-2.5 rounded-lg text-red-500 hover:bg-red-50">
                    <i class="fas fa-sign-out-alt w-6 text-center"></i>
                    <span class="ml-3">Đăng xuất</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white border-b p-4 flex justify-between items-center flex-shrink-0">
                <div>
                    <nav class="text-sm text-gray-500" aria-label="Breadcrumb">
                        <ol class="list-none p-0 inline-flex">
                            <li class="flex items-center">
                                <a href="dashboard.html" class="hover:text-indigo-600">Bảng điều khiển</a>
                                <i class="fas fa-chevron-right mx-2"></i>
                            </li>
                            <li class="flex items-center">
                                <span class="text-gray-700 font-medium">Thiết kế Website Cá Nhân</span>
                            </li>
                        </ol>
                    </nav>
                    <h1 class="text-2xl font-semibold text-gray-800 mt-1">Khóa học Thiết kế Website Cá Nhân</h1>
                </div>
                <a href="https://kontum01-my.sharepoint.com/:b:/g/personal/quanth_c12sb_st_gdkontum_edu_vn/ETOnBJ3_yMpCsR_kFyG48zQBzlgDaGvbGSeeBmfUygpDKw?e=qDBNm7" target="_blank" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center">
                    <i class="fas fa-download mr-2"></i>
                    <span>Tài liệu</span>
                </a>
            </header>

            <!-- Content Area -->
            <main class="flex-1 flex overflow-hidden">
                <!-- Video Player -->
                <div class="flex-1 bg-gray-900 flex items-center justify-center">
                    <iframe id="videoPlayer" class="w-full h-full" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <!-- Course Curriculum -->
                <aside class="w-96 bg-white border-l overflow-y-auto flex-shrink-0">
                    <div class="p-4 border-b">
                        <h2 class="text-lg font-semibold">Nội dung khóa học</h2>
                        <!-- Progress Bar -->
                        <div class="mt-3">
                            <div id="progressText" class="text-sm font-medium text-gray-600 mb-1">Đang tải tiến độ...</div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div id="curriculum">
                        <!-- Curriculum items will be populated here -->
                    </div>
                </aside>
            </main>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const courseId = 'khoahoc_thietkewebcanhan';
            const curriculumContainer = document.getElementById('curriculum');
            const videoPlayer = document.getElementById('videoPlayer');
            const progressText = document.getElementById('progressText');
            const progressBar = document.getElementById('progressBar');

            const courseData = [
                { 
                    title: "Phần 1. Khởi động", 
                    lessons: [
                        { id: "https://youtu.be/2Bd_sE9wVhI", title: "1.1. Làm quen với khóa học" },
                        { id: "https://youtu.be/t7uwWG-VKCM", title: "1.2. Xác định mục tiêu học tập" },
                        { id: "https://youtu.be/PdJKguKLTK0", title: "1.3. Khám phá sản phẩm mẫu" }
                    ]
                },
                { 
                    title: "Phần 2. Khám phá giao diện", 
                    lessons: [
                        { id: "https://youtu.be/gmYGzqYQeW0", title: "2.1. Bắt đầu với bảng điều khiển" }
                    ]
                },
                { 
                    title: "Phần 3. Viết và xuất bản", 
                    lessons: [
                        { id: "https://youtu.be/70CfsnsqEKM", title: "3.1.1. Định dạng văn bản" },
                        { id: "https://youtu.be/7puNjxAjbVo", title: "3.1.2. Thêm đa phương tiện" },
                        { id: "https://youtu.be/zinxxipWoIA", title: "3.1.3. Quản lý bài viết" },
                        { id: "https://youtu.be/uiRpEQve2QQ", title: "3.2.1. Giới thiệu chế độ HTML" },
                        { id: "https://youtu.be/-9nziydeEJQ", title: "3.2.2. TH 1 – Bài viết có nội dung" },
                        { id: "https://youtu.be/1rhnevEN4GE", title: "3.2.3. TH 2 – Bài viết nhúng video" },
                        { id: "https://youtu.be/9PDuoF1DkFk", title: "3.2.4. TH 3 – Bài viết nhúng ứng dụng" }
                    ]
                },
                { 
                    title: "Phần 4. Quản lý và tối ưu", 
                    lessons: [
                        { id: "https://youtu.be/ROTx-htO4tk", title: "4.1. Quản lý bài viết" }
                    ]
                },
                { 
                    title: "Phần 5. Tổng kết", 
                    lessons: [
                        { id: "https://youtu.be/IBJr5eLK-0g", title: "5.1. Ôn tập kỹ năng" },
                        { id: "https://youtu.be/J5alo3UTD0A", title: "5.2. Mở rộng & nâng cấp" }
                    ]
                }
            ];

            // --- STATE MANAGEMENT ---
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const progressKey = `progress_${courseId}_${currentUser ? currentUser.username : 'guest'}`;
            let completedLessons = JSON.parse(localStorage.getItem(progressKey)) || [];

            // --- AUTHORIZATION ---
            if (!currentUser || !currentUser.courses || !currentUser.courses.includes(courseId)) {
                alert('Bạn không có quyền truy cập khóa học này.');
                window.location.href = 'login.html';
                return;
            }

            // --- FUNCTIONS ---
            const saveProgress = () => {
                localStorage.setItem(progressKey, JSON.stringify(completedLessons));
            };

            const updateProgressUI = () => {
                const allLessons = document.querySelectorAll('.lesson-item');
                const totalLessons = allLessons.length;
                const completedCount = completedLessons.length;
                const percentage = totalLessons > 0 ? Math.round((completedCount / totalLessons) * 100) : 0;

                progressText.textContent = `Hoàn thành ${completedCount}/${totalLessons} bài (${percentage}%)`;
                progressBar.style.width = `${percentage}%`;

                allLessons.forEach(item => {
                    const lessonId = item.dataset.video;
                    const icon = item.querySelector('.lesson-icon');
                    if (completedLessons.includes(lessonId)) {
                        item.classList.add('completed');
                        icon.classList.remove('fa-circle-play');
                        icon.classList.add('fa-circle-check');
                    } else {
                        item.classList.remove('completed');
                        icon.classList.remove('fa-circle-check');
                        icon.classList.add('fa-circle-play');
                    }
                });
            };

            const playVideo = (lessonItem) => {
                const lessonId = lessonItem.dataset.video;
                
                // Update active state
                document.querySelectorAll('.lesson-item').forEach(li => li.classList.remove('active'));
                lessonItem.classList.add('active');

                // Mark as completed and save
                if (!completedLessons.includes(lessonId)) {
                    completedLessons.push(lessonId);
                    saveProgress();
                }
                
                // Update UI
                updateProgressUI();

                // Load video
                const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
                const match = lessonId.match(youtubeRegex);
                if (match && match[1]) {
                    videoPlayer.src = `https://www.youtube.com/embed/${match[1]}?autoplay=1&rel=0`;
                }
            };

            const renderCurriculum = () => {
                let html = '';
                courseData.forEach((section, index) => {
                    html += `
                        <div class="section">
                            <div class="section-title flex justify-between items-center p-4 cursor-pointer border-b hover:bg-gray-50">
                                <span class="font-semibold">${section.title}</span>
                                <i class="fas fa-chevron-down transform transition-transform duration-200"></i>
                            </div>
                            <div class="section-content ${index === 0 ? 'open' : ''}">
                                ${section.lessons.map(lesson => `
                                    <div class="lesson-item flex items-center p-4 border-b cursor-pointer" data-video="${lesson.id}">
                                        <i class="lesson-icon far fa-circle-play text-gray-400 w-6 text-center mr-3"></i>
                                        <span class="flex-1">${lesson.title}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                curriculumContainer.innerHTML = html;
            };

            // --- INITIALIZATION ---
            renderCurriculum();
            updateProgressUI();

            // Add event listeners to newly rendered elements
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.addEventListener('click', () => playVideo(item));
            });

            document.querySelectorAll('.section-title').forEach(title => {
                title.addEventListener('click', () => {
                    title.nextElementSibling.classList.toggle('open');
                    title.querySelector('i').classList.toggle('rotate-180');
                });
            });

            // Auto-play first uncompleted lesson or the very first lesson
            const firstUncompleted = document.querySelector('.lesson-item:not(.completed)');
            if (firstUncompleted) {
                playVideo(firstUncompleted);
            } else {
                const firstLesson = document.querySelector('.lesson-item');
                if (firstLesson) {
                    playVideo(firstLesson);
                }
            }
        });
    </script>
</body>
</html>
